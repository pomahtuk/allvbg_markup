!function(){$(function(){var e,t,n,i,o,r;return o=function(e){return 0===e.level?e.name:null!=e.style_img?"<img class='mapicon' src='http://allvbg.ru/static/allvbg/"+e.style_img+"'/>"+e.name:e.name},r=function(e){return e.name},t=function(e,t,n){var i,o,r,s;for(o=[],r=0,s=e.length;s>r;r++)i=e[r],"id"===n&&(t=parseInt(t,10)),i[n]===t&&o.push(i);return o},i=function(e,n){var i,o,r,s,a,l,c,d,u,h,p,f;for(c=t(e,0,"level"),d=0,h=c.length;h>d;d++)for(r=c[d],s="/api/v1/firm/"+r.id+"/",r.children=[],o=delete r.id,r.children=t(e,s,"parent"),f=r.children,u=0,p=f.length;p>u;u++)i=f[u],a=i.map_style.split("/map_style/")[1].split("/")[0],l=t(n,a,"id")[0],i.style_img=l.value;return c},e=function(e,t){return $.ajax({url:e,dataType:"jsonp"}).done(function(e){return null!=t?t(e.objects):void 0})},n=function(){return flow.exec(function(){return e("http://allvbg.ru/api/v1/firm/?limit=120&container=true",this.MULTI("firm")),e("http://allvbg.ru/api/v1/map_style/?limit=120",this.MULTI("style"))},function(e){return window.new_results=i(e.firm,e.style),$("#id_parent").select2({data:{results:new_results,text:"name"},formatResult:o,formatSelection:r})})},$("#id_description").redactor(),$("#id_short").redactor(),n()})}.call(this);